<!DOCTYPE html>
<html>
    <head>
        <title>Chat Room</title>
    </head>
    <body>
        <h1>Welcome to the Chat Room</h1>
        <label for="username">Username:</label>
        <input type="text" id="username" placeholder="Enter your username" />
        <button onclick="connect()">Connect</button>
        <ul id="messages"></ul>
        <h2>Currently Connected Users:</h2>
        <ul id="user_list"></ul>
        <form onsubmit="sendMessage(event)">
            <input type="text" id="messageText" autocomplete="off" />
            <button>Send</button>
        </form>
        <script>
            var ws;

            function connect() {
                var username = document.getElementById("username").value;
                ws = new WebSocket("ws://localhost:8000/ws");
                ws.onopen = function (event) {
                    ws.send(JSON.stringify({ username: username }));
                };
                ws.onmessage = function (event) {
                    var data = JSON.parse(event.data);
                    if (data.content === "User list update") {
                        updateUserList(data.user_list);
                    } else {
                        var messages = document.getElementById("messages");
                        var message = document.createElement("li");
                        message.textContent = `${data.timestamp} - ${data.username}: ${data.content}`;
                        messages.appendChild(message);
                    }
                };
            }

            function sendMessage(event) {
                var input = document.getElementById("messageText");
                ws.send(JSON.stringify({ content: input.value }));
                input.value = "";
                event.preventDefault();
            }

            function updateUserList(userList) {
                var userListElem = document.getElementById("user_list");
                userListElem.innerHTML = "";
                userList.forEach(function (user) {
                    var userElem = document.createElement("li");
                    userElem.textContent = user;
                    userListElem.appendChild(userElem);
                });
            }
        </script>
    </body>
</html>
